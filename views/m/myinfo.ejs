<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" charset="utf-8" />
    <script src="http://code.jquery.com/jquery-3.2.1.js"></script>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
</head>

<body>
<script>

    function showgraph(elemname, data){
        new Chartist.Line(elemname, {
            series: [
                data
            ]
        }, {
            fullWidth: true,
            chartPadding: {
                right: 40
            }
        });
    }

    $(document).ready(function(){
        $('#loginform').submit(function(){
            if( $('#loginform #user_id').val() == '' || $('#loginform #user_pwd').val() == '' ) {
                alert('아이디 또는 비밀번호를 입력 해 주세요');
                return false;
            }

            $.post("/checkpwd", {user_id:$('#loginform #user_id').val(), user_pwd:$('#loginform #user_pwd').val(), return_url:'/m/myinfo'}, function(data) {
               if( data.ret == -1 ) {
                   $('#alert_message').html('아이디 또는 비번이 잘못 되었습니다.');
               }
               else {
                   location.reload();
               }

            });

            return false;
        })

        $('#league').hide();
        $('#record_league').click(function(){
            $('#league').toggle();
            showgraph('.ct-chart', data);
        })

        $('#individual').hide();
        $('#record_individual').click(function(){
            $('#individual').toggle();
            showgraph('.ct-chart-individual', data_individual);
        })

        var data = [];
        <% for(var i = data.length-1 ; i >= 0  ; --i) { %>
            if(data.length < 10) {
                data.push(<%- data[i].score %>);
            }
        <% } %>

        var data_individual = [];
        <% for(var i = data_individual.length-1 ; i >= 0  ; --i) { %>
        if(data_individual.length < 10) {
            data_individual.push(<%- data_individual[i].score %>);
        }
        <% } %>
    });
</script>
<%-  include header.ejs %>
<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
<div id="main">
    <% if(!session) {%>
    <div id="no_session">
        <p>개인기록은 로그인 후 확인 가능</p>
        <form id="loginform">
            <div>
                <table style="width:250px; margin:auto;" id="myinfo_tbl">
                    <tr>
                        <td style="width: 100px;">웨보아이디</td>
                        <td style="width: 150px;"><input type="text" id="user_id" name="user_id" style="width: 140px;"/></td>
                    </tr>
                    <tr>
                        <td>비밀번호</td>
                        <td><input type="password" id="user_pwd" name="user_pwd" style="width: 140px;"/></td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input style="width: 100%;height: 40px;" type="submit" value="로그인"/>
                        </td>
                    </tr>
                </table>
                <input type="hidden" value="/m/myinfo" name="return_url"/>
            </div>
        </form>
        <div id="alert_message"></div>
    </div>
    <%}else {%>
    <div id="session_ok">
        <p><%=session%>님 안녕하세요. <a href="/m/logout">로그아웃</a></p>
        타이틀을 누르면 상세항목이 보입니다.
    </div>
    <div class="main_sub_title" id="record_league">동호회 기록</div>
    <div id="league">
        <% if(data.length == 0) {%>
        <div>기록이 없습니다. 볼링장 ㄱㄱ싱?</div>
        <%}else {%>
        <p style="color:#830000; font-weight: bold;">총 에버리지 : <%= avg %>점</p>
        <div>최근 게임 그래프</div>
        <div class="ct-chart"></div>
        <table style="width: 200px; margin:auto;">
            <tr style="height: 30px;">
                <td>날짜</td>
                <td>점수</td>
            </tr>
            <% for(var i = 0 ; i < data.length ; ++i) { %>
            <tr>
                <td><%= data[i].regdate %></td>
                <td><%= data[i].score %></td>
            </tr>
            <% } %>
        </table>
        <% } %>
    </div>

    <br>
    <div class="main_sub_title" id="record_individual">개인 기록</div>
    <div id="individual">
        <% if(data_individual.length == 0) {%>
        <div>기록이 없습니다. 볼링장 ㄱㄱ싱?</div>
        <%}else {%>
        <p style="color:#830000; font-weight: bold;">총 에버리지 : <%= avg_individual %>점</p>
        <div>최근 게임 그래프</div>
        <div class="ct-chart-individual"></div>
        <table style="width: 200px; margin:auto;">
            <tr style="height: 30px;">
                <td>날짜</td>
                <td>점수</td>
            </tr>
            <% for(var i = 0 ; i < data_individual.length ; ++i) { %>
            <tr>
                <td><%= data_individual[i].regdate %></td>
                <td><%= data_individual[i].score %></td>
            </tr>
            <% } %>
        </table>
        <% } %>
    </div>
    <%}%>
</div>
<%-  include footer.ejs %>
</body>

</html>