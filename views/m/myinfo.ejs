<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" charset="utf-8" />
    <script src="http://code.jquery.com/jquery-3.2.1.js"></script>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
</head>

<body>
<script>
    $(document).ready(function(){
        $('#loginform').submit(function(){
            if( $('#loginform #user_id').val() == '' || $('#loginform #user_pwd').val() == '' ) {
                alert('아이디 또는 비밀번호를 입력 해 주세요');
                return false;
            }

            $.post("/checkpwd", {user_id:$('#loginform #user_id').val(), user_pwd:$('#loginform #user_pwd').val(), return_url:'/m/myinfo'}, function(data) {
               if( data.ret == -1 ) {
                   $('#alert_message').html('아이디 또는 비번이 잘못 되었습니다.');
               }
               else {
                   location.reload();
               }

            });

            return false;
        })

        var data = [];
        <% for(var i = data.length-1 ; i >= 0  ; --i) { %>
            if(data.length < 10) {
                data.push(<%- data[i].score %>);
            }
        <% } %>

        new Chartist.Line('.ct-chart', {
            series: [
                data
            ]
        }, {
            fullWidth: true,
            chartPadding: {
                right: 40
            }
        });
    });
</script>
<%-  include header.ejs %>
<!-- Add all page content inside this div if you want the side nav to push page content to the right (not used if you only want the sidenav to sit on top of the page -->
<div id="main">
    <% if(!session) {%>
    <div id="no_session">
        <p>개인기록은 로그인 후 확인 가능</p>
        <form id="loginform">
            <div>
                <table style="width:250px; margin:auto;" id="myinfo_tbl">
                    <tr>
                        <td style="width: 100px;">웨보아이디</td>
                        <td style="width: 150px;"><input type="text" id="user_id" name="user_id" style="width: 140px;"/></td>
                    </tr>
                    <tr>
                        <td>비밀번호</td>
                        <td><input type="password" id="user_pwd" name="user_pwd" style="width: 140px;"/></td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input style="width: 100%;height: 40px;" type="submit" value="로그인"/>
                        </td>
                    </tr>
                </table>
                <input type="hidden" value="/m/myinfo" name="return_url"/>
            </div>
        </form>
        <div id="alert_message"></div>
    </div>
    <%}else {%>
    <div id="session_ok">
        <p><%=session%>님 안녕하세요. <a href="/m/logout">로그아웃</a></p>
    </div>
    <% if(data.length == 0) {%>
    <div>기록이 없습니다. 볼링장 ㄱㄱ싱?</div>
    <%}else {%>
    <p style="color:#830000; font-weight: bold;">총 에버리지 : <%= avg %>점</p>
    <div>최근 게임 그래프</div>
    <div class="ct-chart"></div>
    <table style="width: 200px; margin:auto;">
        <tr style="height: 30px;">
            <td>날짜</td>
            <td>점수</td>
        </tr>
        <% for(var i = 0 ; i < data.length ; ++i) { %>
        <tr>
            <td><%= data[i].regdate %></td>
            <td><%= data[i].score %></td>
        </tr>
        <% } %>
    </table>
    <% } %>
    <%}%>
</div>
</body>

</html>